version: "3"

services:
  api:
    image: ${ECR_HOST:-755619740999.dkr.ecr.us-east-1.amazonaws.com/dpc-api-go}:latest
    build:
      context: .
      dockerfile: docker/Dockerfiles/Dockerfile.api
    volumes:
      - /tmp:/tmp
    ports:
      - "3000:3000"
      - "3011:3011"
    environment:
      - DPC_PUBLIC_PORT=3000
      - DPC_ADMIN_PORT=3011
      - DPC_ATTRIBUTION-CLIENT_URL=https://attribution2:3001
      - DPC_SSAS-CLIENT_ADMIN-URL=http://ssas:3004
      - DPC_SSAS-CLIENT_PUBLIC-URL=http://ssas:3003
      - DPC_CA_CERT=-----BEGIN CERTIFICATE-----\nMIIDIDCCAggCCQDYxc6fReJIzDANBgkqhkiG9w0BAQsFADBSMQswCQYDVQQGEwJV\nUzELMAkGA1UECAwCQ0ExEzARBgNVBAcMCkxvc0FuZ2VsZXMxDTALBgNVBAoMBEFD\nTUUxEjAQBgNVBAMMCWxvY2FsaG9zdDAeFw0yMTA4MDMyMDEzMDJaFw0yMjA4MDMy\nMDEzMDJaMFIxCzAJBgNVBAYTAlVTMQswCQYDVQQIDAJDQTETMBEGA1UEBwwKTG9z\nQW5nZWxlczENMAsGA1UECgwEQUNNRTESMBAGA1UEAwwJbG9jYWxob3N0MIIBIjAN\nBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAyylxcIseEtrEjgR5Aca+vOzzCc4b\nOuMLZk5UrrgAb6C/r4aVC3umYNQ3mwbyxhpb505GxtwCgHBGKi30vCP35kjn1rdn\nkpwWbvibSGCrWlPsHAHqAJxmi1c/Z3VQRFxynnvut8/FDv+iYoAuP33t2O8V19ZV\nIG64m6UHV3rHuWTf03wVMHC3MJU1N5Y3B/T+1R4p4ixGiZEHPTRF39DzyC+Vrb4c\nIBIvqww2RNL0qYtjQVaLzwNVhkEqSnXA88SgJwLmaMhwvG3BKFCn9sgWT0hxSF96\n5eomP7zu7AnqmQlQpZRa0Gg/KMHc+Tas37gp/s/MVJH9k63gytoCyzSfXwIDAQAB\nMA0GCSqGSIb3DQEBCwUAA4IBAQAa3YYD+x29LnYeMsglktjirBfi2RRxgbBHzUt9\n/qkwoTD8tgDBqQzxI5xNcD3nXO9B015AFk6zk9MAK/gpJBSZOGPdahxAUr7Hi/ua\ns425NzdG37oGi92ivc/773kxblP+LVs0czC/XIjTLChksUSwdE7U4bdjLfORkjzT\nUNxdRKQxzBpIV/AWFy5VS+AvOh/6Bx3D9YtUZ1FIMiftu/nzmhCA0+3ADR2yULj7\nqLnSiAs+j8zGObKQmXWLtiTr0+h+Tx7eKV6KY+7zB5rRcXlfQd1SFYIpGq7NM4x8\nNeWgLhsv+TV2R5Dt/h0hoDC241CFgFMOlovGOjMMAjyJ1RBL\n-----END CERTIFICATE-----\n
      - DPC_CERT=-----BEGIN CERTIFICATE-----\nMIIDWjCCAkKgAwIBAgIJAO9s2CNpDOWeMA0GCSqGSIb3DQEBCwUAMFIxCzAJBgNV\nBAYTAlVTMQswCQYDVQQIDAJDQTETMBEGA1UEBwwKTG9zQW5nZWxlczENMAsGA1UE\nCgwEQUNNRTESMBAGA1UEAwwJbG9jYWxob3N0MB4XDTIxMDgwMzIwMTMwM1oXDTIy\nMDgwMzIwMTMwM1owVjELMAkGA1UEBhMCVVMxCzAJBgNVBAgMAkNBMRMwEQYDVQQH\nDApMb3NBbmdlbGVzMREwDwYDVQQKDAhBQ01FIEFQSTESMBAGA1UEAwwJbG9jYWxo\nb3N0MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAu0D2uuJhnR2Q8Wrk\ntuHPpKbsutwE7XZdCbdgdAlb0MPmSsS7OVxK8CObchRARFKTZIqWdyG8eVdbJgMI\nVIaD/51rHXwHaOgjG+PyGrX1HHkhuVS9/gao8oGib9HbJRlqI5uaVoBfEdv58UVF\n0egLJNG1RYrq2RcYr5hNF5C10E7Jc6jAhr/qeuMtm3TKfMG8EPFQAEvLKcgYz/Lc\nhI9nZWSxiOXrBoxyQqVnoFIIwE7AOmtsLn09pvjcnhhOYK3iaMlT0ZFxUuHKPa+3\nFJ+/DahSo5qPk/sa39v+q72QHKvxItGJQHCWqPzJl8k2escGaqdL8Wm6IinQX4mj\nGVvmzQIDAQABoy8wLTArBgNVHREEJDAigglsb2NhbGhvc3SCFWxvY2FsLmFwaS5k\ncGMuY21zLmdvdjANBgkqhkiG9w0BAQsFAAOCAQEAJcZFuPTTlWE3ZVfoehYWv6O/\nx+ha7p870tx0j7xpKBGJcpFBdBaaZ2KAoi3LSyU+18++srqWhiWQHqtZLRTO9SCy\ncSaSSSBNYoD1upU4j0tSoRvh6Bd2s6bPzgclO+zdGP7Fv6wCa7J0THPXBMeuRCBM\nPgpX5TY3Yf17IgHYAVWiJTr7V1EEvKs5eXp/cmY6OKPITlCv5I7W9VT/lTEGSA81\nL4446Ahg3EXsklFVsdfhcMxEo/QXQOxNUJY+42i7NAHCOT2thaXY4dYmBAmmj7XV\nLks6sOc/O7zxOS1zpSp42txyU63T9GTvv0cAz53ZWMgug6ZWBY8PuId28eLcAA==\n-----END CERTIFICATE-----\n
      - DPC_CERT_KEY=-----BEGIN RSA PRIVATE KEY-----\nMIIEowIBAAKCAQEAu0D2uuJhnR2Q8WrktuHPpKbsutwE7XZdCbdgdAlb0MPmSsS7\nOVxK8CObchRARFKTZIqWdyG8eVdbJgMIVIaD/51rHXwHaOgjG+PyGrX1HHkhuVS9\n/gao8oGib9HbJRlqI5uaVoBfEdv58UVF0egLJNG1RYrq2RcYr5hNF5C10E7Jc6jA\nhr/qeuMtm3TKfMG8EPFQAEvLKcgYz/LchI9nZWSxiOXrBoxyQqVnoFIIwE7AOmts\nLn09pvjcnhhOYK3iaMlT0ZFxUuHKPa+3FJ+/DahSo5qPk/sa39v+q72QHKvxItGJ\nQHCWqPzJl8k2escGaqdL8Wm6IinQX4mjGVvmzQIDAQABAoIBAQC28HncDO0mzUrc\nwPzfuu7cwoQG7osV34x3wKLH2pjL9YeYxmjPWl6QC4mDQ0uiNDZxhIAJtXjn5zNS\niKXrxltRMF8EuDaZBCnAxsqx09C615Dd+m9/rMwD2Ch1LEX4EcNDNHLtTY8T6KBg\nWbgjoZq5hvOdFGHqY4knjBjNDADEl3drUu6C72k6fBJcXCCBoYY2QNVLGp+CVWkW\n3K2U0varCdlSE6qgurmc7B0KEMzEz7ZeF6v0NlWk2s9vExhEcu92opyZBitVWiie\nj8vLS0jcWsmyyvfeie8tks8nrNvtz80IyRtiYek8ig3JzIebt6Ht6gCzsspKm8Lw\nXeCEzUOhAoGBAOwgSgpn82oStvQt/fqjCrgX01qci25lDkE1gljxGGV+21wgDwJg\nnpgzeI0lU2DIEQNWfYNuQAUEZWKK+UqrpuwTQU2QEJAQ9R8UkXYZ80tAXuDfCB/7\nPkkmDn06iFyUto+IHPZoBD+YiogWOLSJVP5Qlr7Onwvvz7sSIxkCr1gVAoGBAMsD\npGcVCg0MSlH7xzLTXpTaVnwJf3F85ouvq+YuMH2/jw/QsA7wPIFXlO3/3w/nRTjT\nrApw8YWQ25TO0Nure39XjuWH+HvpAg5BhKpKV/3KBIZ4A35bO3iPtmqdKUWb2OLK\nndi1wK2T9CPIgmA8g0cc8JD7xSzA8pCP1Eog+4nZAoGAIib9bongfBwe2Cx6yrCg\nUUYo7Lctt5boO+hIZSLh+3QguC9u3FIrPipbqlaWu63UQB5XYxYkLlWXcGxXaERx\njT2vuU84Bg5d1dP8wg840E6MKow3uaB2PtBBUj2QEYv058exILakvqoKh2pnYz1l\nzK7NTuXFvU0/R3h1GR35TI0CgYARdJ+3KUzy8EKXqAFpsljojZlwEtT9ahLcod8y\n7HfI6Cah4nyw3CEnseMhT6XbVTRTfYfGYg2yQVFQCzRUHvuAaIPl4noQFWnS1flV\nNw03yh33few2+hsz849ovVimHo9YeLl3v7Dwe887IGttYOacv7VDkhJTFcgFfAhx\n00ItiQKBgDyOjmfuYi/0mv55wQjhjbvPsFhT1qf1oT2Ud7KdhkA1lCYF6KmZeXla\nJOZra0tfsz+8kgVr9/vwFv7DSbMsTuXgvEf3goxuJBuh/wO3oVCmusd4zvH7bJKT\nSoO9NtOjagcf7jCqWkiqqvOpZFNOE7rttBhzimBSXdZ0PW+CgAFL\n-----END RSA PRIVATE KEY-----\n
      - DPC_SSAS-CLIENT_CLIENT-ID=31e029ef-0e97-47f8-873c-0e8b7e7f99bf
      - DPC_SSAS-CLIENT_CLIENT-SECRET=?