version: "3"

services:
  api:
    image: ${ECR_HOST:-755619740999.dkr.ecr.us-east-1.amazonaws.com/dpc-api-go}:latest
    build:
      context: .
      dockerfile: docker/Dockerfiles/Dockerfile.api
    volumes:
      - /tmp:/tmp
    ports:
      - "3000:3000"
      - "3011:3011"
    environment:
      - DPC_PUBLIC_PORT=3000
      - DPC_ADMIN_PORT=3011
      - DPC_ATTRIBUTION-CLIENT_URL=https://attribution2:3001
      - DPC_SSAS-CLIENT_ADMIN-URL=http://ssas:3004
      - DPC_SSAS-CLIENT_PUBLIC-URL=http://ssas:3003
      - DPC_SSAS-CLIENT_CLIENT-ID=31e029ef-0e97-47f8-873c-0e8b7e7f99bf
      - DPC_SSAS-CLIENT_CLIENT-SECRET=?
      - DPC_CERT=LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURVakNDQWpxZ0F3SUJBZ0lKQUkyVGdBWkZLTUR5TUEwR0NTcUdTSWIzRFFFQkN3VUFNRkl4Q3pBSkJnTlYKQkFZVEFsVlRNUXN3Q1FZRFZRUUlEQUpEUVRFVE1CRUdBMVVFQnd3S1RHOXpRVzVuWld4bGN6RU5NQXNHQTFVRQpDZ3dFUVVOTlJURVNNQkFHQTFVRUF3d0piRzlqWVd4b2IzTjBNQjRYRFRJeE1Ea3hOakEwTURjeU0xb1hEVEl5Ck1Ea3hOakEwTURjeU0xb3dWekVMTUFrR0ExVUVCaE1DVlZNeEN6QUpCZ05WQkFnTUFrTkJNUk13RVFZRFZRUUgKREFwTWIzTkJibWRsYkdWek1SSXdFQVlEVlFRS0RBbEJRMDFGSUVGMGRISXhFakFRQmdOVkJBTU1DV3h2WTJGcwphRzl6ZERDQ0FTSXdEUVlKS29aSWh2Y05BUUVCQlFBRGdnRVBBRENDQVFvQ2dnRUJBTktMaHVUSWJVRTkzWXNaCjMzU2I3TXhNZVNaNTlqOWxUNTFBTTY1YWpReWlGZUdqaDc4eSs0U1RuQm5hV245TGpCK25SZlRjNG5LYlVGRUsKQk4rcGpONzZGazhnSjE3M3lvbU9MVWNNWG9YbnRhamtpRkZhNU9YUHN4c3BrcDZrVnVZS0dnL0dQRmljNVQxNgp2QkFqQnptK2JGUHNxYWJ2V2t0UEVJbEt3Tmc1MkZHQmRpdmMxT2hKRUZEbENYajBGL1g5ZWJWSENUNE9PeHJoCk42KzNDVVZjSUU0T1pJOUVHeThGK01VYlpGa3l6ZXQ5VXZZdFVGMmlNcUFjNWtrbE9jUENVaUc1dlZqeTZyckgKSzMyWGM5ak93R2o3ZVVJeUREZ0dwUm9qUVZwdEViMEZ3SjBSdW5DMTZnSjZYbUlHV2IvWTdPKytLVkkwNDR2YQpHd0xoaHVrQ0F3RUFBYU1tTUNRd0ZBWURWUjBSQkEwd0M0SUpiRzlqWVd4b2IzTjBNQXdHQTFVZEV3UUZNQU1CCkFmOHdEUVlKS29aSWh2Y05BUUVMQlFBRGdnRUJBQlZaSCtxLytrNUl4Vy9pZzVySzNSc3k2Tmhaa3h5TTNRdTIKMlNtNzJ1YUk3S3FMRzNDa1dWN1V1TDZOV0c2RDl5NFFhcC9BaU5xdHVXa0xBRWhEb0VpdDhiK2NtaDNYRWhWawoyVlVNSHdZZDRpUjVIRithT0dFNkVSUURxZzg3MldRbmdGSnlNZ0ZtSy9nK0pWRjhFSGx5VEw0bkhWaUp6TVlnCjBmcUovQUFsa3kxam5mSUtIdklVTjdhMUlSRnhCNEgzL20xMVhweDlFSDdBZVVGM1ZyNkVwTS9SR3RqZndxUVoKZTF3YU9LMnZuMFFjbHo2RDJSalZ3b21Cc1lYdnRDZGx3MG52UHdGYWgrWXg0aTBTQkZDVk1QY0FtODlKYVA1Ngp4SUFaRWMzK1ZMbW1xekxQTW9ZYzFqTGpld0t5WXJ4VnZOblA2RGg3SDZLVXExYlJ5K1U9Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K
      - DPC_CERT_KEY=LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlFcEFJQkFBS0NBUUVBMG91RzVNaHRRVDNkaXhuZmRKdnN6RXg1Sm5uMlAyVlBuVUF6cmxxTkRLSVY0YU9ICnZ6TDdoSk9jR2RwYWYwdU1INmRGOU56aWNwdFFVUW9FMzZtTTN2b1dUeUFuWHZmS2lZNHRSd3hlaGVlMXFPU0kKVVZyazVjK3pHeW1TbnFSVzVnb2FEOFk4V0p6bFBYcThFQ01IT2I1c1UreXBwdTlhUzA4UWlVckEyRG5ZVVlGMgpLOXpVNkVrUVVPVUplUFFYOWYxNXRVY0pQZzQ3R3VFM3I3Y0pSVndnVGc1a2owUWJMd1g0eFJ0a1dUTE42MzFTCjlpMVFYYUl5b0J6bVNTVTV3OEpTSWJtOVdQTHF1c2NyZlpkejJNN0FhUHQ1UWpJTU9BYWxHaU5CV20wUnZRWEEKblJHNmNMWHFBbnBlWWdaWnY5anM3NzRwVWpUamk5b2JBdUdHNlFJREFRQUJBb0lCQUdFOGRSa1dBM2M5RmlNVwoyTjltMzY3ZXBwa0JmSnQ4czQ4aFJuMEFidUhsdll0TzFmT1VuUnAyZllKbkdLSnZocEJiMVhBbnp5RTAzNXY5CnI1Q0lJbm9jTDg5dFB5R1orTjBjWDRiUGpKdjFEaTJwRmRmVXpaL2hFNHU0NEhFSjN1UXd5Q1orM0FIa3UrNXYKejRqNFZHN3pwZDRBajcxOEQweDJnR0dYdDRaa0lWQVZGbzVnZStQanlUOWpjMnovd0twWXdOb25TUE03NmNTawowSlhpNmEzOG04aThGU3VpY0d6ZjdOaENwMUlWanZsN3ZYY01sa0lVTE5xZ3Nva2hhQk9ubWMzcWpqMEhVQmdiCko4QUZXNGlNOS9wc0w0Q3lOcHhvaWlQLzQ2dlJ3K3dSbU9kajkzZWduUnRKOGpBcWdYVm5rZ0FvRm1VM3FoMloKbFBtQkF6RUNnWUVBL2xrNkprRUZmV1IyTDNpYjJ4SHhVb3l1V3Z2SWVHbFJnQjRBYUU0aTlHM2M5Uk1pTEpKbApvMlZ2U1gwVm1LZElBaUgvRm5BRkVxL3oySjVqaWVGY2toL2lnQzFZMXA0NjdlbmdaT3lTVkZRRHkzQysxU0dyCjd5QmhVTm9SWWk2UlFsM2k0VW5tQjBQSWtsY2xpT0VUYi91Vit2ek5pS3NCUnFQaXQwMmZieDBDZ1lFQTArbDkKa0xHVWJZdUY5OURDd0I5WUhhTHllaXlEckd6ZGNBMmNtalU0WGF6S0luS2pGMVZuSGFPS2t6dWNSc21NelJrRQpwdnpGeFFidmJhNk5KQTh0ZlhOcGtHejRienpLWGFwcVNvdGsvWkdndlAvWkJkTzZKUjlNa013RVBYc3FpQWVCCm9OSG9SZ0xEVldMcjZHTzh3bWRTK21qTE5GWXdtVm43eUdhRnNUMENnWUVBL2JwREFPQkNPcmxhRUxjUE96V2wKK0FSdzlrQlAxcGF4ZjgzdCtCOWlUVlcvWXhlSU10Q0Q1Y0VOaUZEb2wxVGd4NGZrY1J5a1l1VDFxelV0OU9ERQp1TnhuMWhmbWxJcGFIUFgvTEk2MjFyck00a2lCaGhuRjY1RHdvM2cyZVN3ZEtnaUFpTjl3UWZVRGc4QzlwOU5uCjBZRTNONTZ5NWxBNHdLQkNUVHQ0L1owQ2dZQmIvNjVIdHhDZFRrbG5BUGJMdWMvamJlNmZJOXcyYXp6bmZNRlUKSVc3TEhFelZEN2ZHVllsaTBMRkVva2lDWXRZQjVLNmtZSERyek1yOWJ4NVBYVmQrY3pDTlJ3SEVLVHdoMWU0MwpWclVOY0wrN3pjZEdSRmszN0pLcytpV05HMytuZHJyTU90VUFNQXJsY3dDLzd5enZxVFBaQ3MzTmR1MjZaZHB0CmNqVHdjUUtCZ1FEK0NacG9RZHk1TUJVS1k0Z3duSTRSdTlQaDNZSXgydzEza1lFU1lDaER3ZzNpZGxJRWpMSUkKY1crRkgxN0FDZzcxVDZva2lzQlNaRFBTZUx2by9RM3h3TVNHVmljME11bkROd08ySlZjZHlWcml3Rkp5TVI0cApiNHNwSXRwM1ByYnJtc3VoSnBKcnVSZzd2WWJHZkM4eTZBSXpmWUlkVEJSNWd6d2oydUx0a1E9PQotLS0tLUVORCBSU0EgUFJJVkFURSBLRVktLS0tLQo=
      - DPC_ATTR_CERT=LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURUekNDQWplZ0F3SUJBZ0lKQUkyVGdBWkZLTUQxTUEwR0NTcUdTSWIzRFFFQkN3VUFNRmN4Q3pBSkJnTlYKQkFZVEFsVlRNUXN3Q1FZRFZRUUlEQUpEUVRFVE1CRUdBMVVFQnd3S1RHOXpRVzVuWld4bGN6RVNNQkFHQTFVRQpDZ3dKUVVOTlJTQkJkSFJ5TVJJd0VBWURWUVFEREFsc2IyTmhiR2h2YzNRd0hoY05NakV3T1RFMk1EUXdOekl6CldoY05Nakl3T1RFMk1EUXdOekl6V2pCZE1Rc3dDUVlEVlFRR0V3SlZVekVMTUFrR0ExVUVDQXdDUTBFeEV6QVIKQmdOVkJBY01Da3h2YzBGdVoyVnNaWE14R0RBV0JnTlZCQW9NRDBGRFRVVWdZWEJwTFdOc2FXVnVkREVTTUJBRwpBMVVFQXd3SmJHOWpZV3hvYjNOME1JSUJJakFOQmdrcWhraUc5dzBCQVFFRkFBT0NBUThBTUlJQkNnS0NBUUVBCjBob2ErK3RpM0s3RFR2V0ZkSW5QS0l4V001blIxYnVuYUxwbGxLUTJSeDlYRGRXMHR5Y0dPck9WNzBtL29WcHQKYzFNZjNkV1Z3TFFSU2dENGdwYTk5a2IrMEN4V25DNXQwUzNtOUNmUHlsZkpCRGkxcEJPR1hXWGdCZGxQL09UUQpPaDRvaVR5RnRpajFhZXgvQWE3S0hwUE5IMDU5eUF6NG1kU25LM0UvaDFKOW1aL3BDQTNKUU5UYnAySU84amlVCk14S21ieUNQeE0vak9SRVhBWkhSdGU4SUdTZTYrLzFkMFN2UlRyTnY3MFIzWmdLeCtFeFRuZVJoUUxGZlVaT1UKL1RkT2d3eisxUmcyVEpsNkkvMHc0UEdRZjNFdWhicTNFQ2p2QVBPREltaEtDYXdMd2N4RUxtNWdYRWlGbzlNbgovSUlOTy9JWVR5bDI4Rlo5dy9MbE9RSURBUUFCb3hnd0ZqQVVCZ05WSFJFRURUQUxnZ2xzYjJOaGJHaHZjM1F3CkRRWUpLb1pJaHZjTkFRRUxCUUFEZ2dFQkFINktvc2NRQ01XY3FQeHQ4ZHRqMUxBNmYxTkRxbXQxN2tLVm5UNEsKejBtK2hBaGxDZitjRkM4Qk16a0Y5a3FOUnJETTVpblgyUjNCT0FJZ2lCUkUrRllkTUtNTjIrMEl2cTF0R0p4dQpXR3ZqZ2d4K01wVkF0L2VYekdvSDVLN0F6OTFnbTZIcFFQWWpYMkxVQTVnbHR1U0dONDB5ODRUVmR2NVRSY3pLClZidGgvaW9VYXd6R0hVekRnTlJ0ME1OV2VEV000MUhQakcxYmdvTDd0dGhjbDJ4c1IrWk9ldnVCT1RkcTJqbjAKeEU4WE9kSEc2ZWMwZElQSE16RXlIeGwraEIzNGFqb0llQ0RuaUJ2N3NYUVFrVCtyRWIrZ09jbXVyOWhvejhEVAprdGtFOUdJN3ZaRGE3QjVrWEVZbUYxdFFuYjdTVHpFUTdJbmhndURXcWgxL09uZz0KLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo=
      - DPC_ATTR_CERT_KEY=LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlFb3dJQkFBS0NBUUVBMGhvYSsrdGkzSzdEVHZXRmRJblBLSXhXTTVuUjFidW5hTHBsbEtRMlJ4OVhEZFcwCnR5Y0dPck9WNzBtL29WcHRjMU1mM2RXVndMUVJTZ0Q0Z3BhOTlrYiswQ3hXbkM1dDBTM205Q2ZQeWxmSkJEaTEKcEJPR1hXWGdCZGxQL09UUU9oNG9pVHlGdGlqMWFleC9BYTdLSHBQTkgwNTl5QXo0bWRTbkszRS9oMUo5bVovcApDQTNKUU5UYnAySU84amlVTXhLbWJ5Q1B4TS9qT1JFWEFaSFJ0ZThJR1NlNisvMWQwU3ZSVHJOdjcwUjNaZ0t4CitFeFRuZVJoUUxGZlVaT1UvVGRPZ3d6KzFSZzJUSmw2SS8wdzRQR1FmM0V1aGJxM0VDanZBUE9ESW1oS0Nhd0wKd2N4RUxtNWdYRWlGbzlNbi9JSU5PL0lZVHlsMjhGWjl3L0xsT1FJREFRQUJBb0lCQUM1S0VCM211MjVSbHJoRAp3Ylp1VWxUbHJteEovSUF4aXUyNCszNW5PNG9wN24wZTAyVHkxUjJEeVluaDNyV0cvY3hGeVNTUDFTR1N5cWhhClZHWTVIZnN2b3g1c1ZseXNvZ2RQTEs0b1ExQ2FUTENBYWd5UFBMQkJMTDA5SnJGYUhFSmh1SjZiMWYzUFFscW0KLzBoNG9SRmhrUFRQejBpUEN3cWhYbjlrd1JGb0JiRUt2b1ZPSWRua2o3MWZVZFdaOUFjRnlRZUVDWjZiSGhKVgpORWVTcVJNUloyV0VEQWV6MFI4a3FCWlhzNldWSnpya2ZGUjBqaTkvNHAzbTI4ZHJMd3lPY0Q3UlI0c1JTNDlUClkva1N6WXVxc2ZZY2Vvam51YWZ1N3BGemlCOWY0eHpPZnZBNW11enJ3ZHllS0dvb29Pa0FlM0FEK0MyZ1RTTFIKUEZ4TG92RUNnWUVBL0p4YXdBd3lpVisxSkd3ZTg1VC82dWNwRDhTbEg3bHBnWjloVWg2ODZkOXY0WGdHTWJ5cQpyakdCdDg2VHdYbDlMTjJwb2lCdEVzRjhCV1lROEd6WlQzemtsZTVWeGNqVG9ra1YrTnhCMmNTVE0zYnVxREFaCllHVzNZS0t6c3c0QUxtSGE3cTlVM3llblFpdEVoZkcxZjdTdFVyMEZGTnFsZ0hvYS9pVTFZQlVDZ1lFQTFPdSsKMUZkUURPZm9OZHZOMXE0eWFNZEMvN0VUa3dnYldzaThpcGcxU25TalBZNHdFSm5NK0tjOUxuNFdyTW5XdkxHWApwTnpvekdBZTY0b3RxQWdVMkRPdnZCOVJVdElpaHFKdEtRTmpObCtUN24zYTk1RlNYRGlrd0RNZzgrNVNybzFSClc0RHB4RUxzT3V5ODYyelBPRHdzOGFsNFZKeUY1a1hBcm1yUFZaVUNnWUVBaU5WNUl3WjRhWWw2YWR4WGQ4S0MKVGhBaFlmVTNMTlFXbnF4aTMwVGZPQ0JjVGxuaG9SZDlyUllNR2pEQVFORTZTUTlaVUFVWWtFeFdqZVlYenVSbgpZbk5Zcnc2SFQ3ZlZTOWNqRzhiVHRNNlNuaElTZlBCeERwS0tuc0lEYlQ1c1FyT25FQnZSY1gvZFRpNTUwOFIyCmVGSzZnRkw3YWF4MmNmMnltWEEyVlhFQ2dZQnMxeG1VZUJHT2wxbUhkcFhSSVBqWndNcEo1RjNxTWlHeGxaMXoKaDN6dVU1TkNteFdNMXVJRlZaQWIzUTZBUXlrSENnMUhsRGxZaCtZbVoxc1JZeGdzc0xjcmhpTFBJR1hQeHVYZwpLa0FrQWxXZmV5eGNreWV6eHF6Skp4bTROK0tDSWZFdHdrYzlNU3lLcm91Z0dONFFsQW94ZW56dFc1bkM3WE1pCmRhMEl4UUtCZ0FpMXVTVlNLZWVmRVRVUUd5N3QvUW4vMnRiL0hJbU96UmQybHliU0ZRN0hqSmVKS2g5a2pnL1EKaVRQNm9yUyswVmRSRjFsUzBKYVVXMkdQNHRSYjlaNzFFMGhLVUo0RXhKcXRNblExTWt3eTFnOGlmTU5MQzR2ZQpSK3I3TjRDWHpUZzRuRjVZTWZWVGtNMHZCQXd0RnRDazVDSXB4V0ZWWEtBTzdnSVRRTTJqCi0tLS0tRU5EIFJTQSBQUklWQVRFIEtFWS0tLS0tCg==
      - DPC_ATTR_CA=LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURJRENDQWdnQ0NRQ0N0Vzl1cEVCakF6QU5CZ2txaGtpRzl3MEJBUXNGQURCU01Rc3dDUVlEVlFRR0V3SlYKVXpFTE1Ba0dBMVVFQ0F3Q1EwRXhFekFSQmdOVkJBY01Da3h2YzBGdVoyVnNaWE14RFRBTEJnTlZCQW9NQkVGRApUVVV4RWpBUUJnTlZCQU1NQ1d4dlkyRnNhRzl6ZERBZUZ3MHlNVEE1TVRZd05EQTNNak5hRncweU1qQTVNVFl3Ck5EQTNNak5hTUZJeEN6QUpCZ05WQkFZVEFsVlRNUXN3Q1FZRFZRUUlEQUpEUVRFVE1CRUdBMVVFQnd3S1RHOXoKUVc1blpXeGxjekVOTUFzR0ExVUVDZ3dFUVVOTlJURVNNQkFHQTFVRUF3d0piRzlqWVd4b2IzTjBNSUlCSWpBTgpCZ2txaGtpRzl3MEJBUUVGQUFPQ0FROEFNSUlCQ2dLQ0FRRUF2dGRtdUVwZHJBMEJQeS9BdFA5dHdLbG5sRHRwCmFWU0VmRjVSSzR1aEp5cUQyQkorVFp6c0JBRUxaRkJhLzVxSlZENUxVTEwyTC9IRUhLL3phSDN6NVBtVFJoQisKMkdGNnh4UnZmcmZ4Mm51WEpxRnJueEFLQkpPWEN6bVBBL0w5OXIyM3BJaStwTFY0dWErQ3VuL2pSeDRNOC96Nwo0ZVA0OXNDNWxzWU1JVjJlbmRnU0Y3R0dxYW9SVElqYmF0RitaL2VBUDVINENuRWJNWnB6bHA1WFA4dTBzQnZICmR2YVBZaHoyalJBdXNZbXg0V0xMMWZpSEdOR0hEWWh5cW8yVWFvRldtdFNJbGZOb1FQVE5FT1Zzbmh5OU12YVgKQTE0K0xEZ0FjMTJSN21JWEFnZVdiSHY0eStoYkN4am9qQTI3MEFjWCsyaDFNeHQwQXBsMktmOVBSUUlEQVFBQgpNQTBHQ1NxR1NJYjNEUUVCQ3dVQUE0SUJBUUNRd1FUUnJWcmRSR1IzQXZldVgrZy9KZ3EranR4NzVMdWpyRGVSCmJrejdackZXT0plT0EwL3V5aXIxd3JBSDJnMU8wQ29HQ2JzZmhOS1dVTWV4N2V6cVVEZjFDM2RKQS85VkxqcnkKREFneTdWWUdSaXdVY3FSbkJYV2tMbnNZS0xHVjEySFExUDZrRFhEUmZVc2JUbjdpV2dOb29YN3ZKN2tBRVZBSQpsRlVST3pqb1p5SWJua1FUdk12aVFMSllLUUVBN295U3RSa1NZejVXY2lBcFkzbGlERkdGNGZRMWtKb2FTSFBwCmNZTHFJVjhaUFhhWWxpM3NvSkQrc1U2ZFFpZ0dWSHh4N3M4YlBNTlBsMHo2WXA4S096QmJSaW1FQ3RtR3NiQloKWTdxdGxvSkxwcHMzdFpIYmlXZGlJU1RONExnWXlIYjBIVGp6MlNjYmpLZmNzUmRpCi0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K