version: "3"

services:
  api:
    image: ${ECR_HOST:-755619740999.dkr.ecr.us-east-1.amazonaws.com/dpc-api-go}:latest
    build:
      context: .
      dockerfile: docker/Dockerfiles/Dockerfile.api
    volumes:
      - /tmp:/tmp
    ports:
      - "3000:3000"
      - "3011:3011"
    environment:
      - DPC_PUBLIC_PORT=3000
      - DPC_ADMIN_PORT=3011
      - DPC_ATTRIBUTION-CLIENT_URL=http://attribution2:3001
      - DPC_SSAS-CLIENT_ADMIN-URL=http://ssas:3004
      - DPC_SSAS-CLIENT_PUBLIC-URL=http://ssas:3003
      - DPC_SSAS-CLIENT_CLIENT-ID=31e029ef-0e97-47f8-873c-0e8b7e7f99bf
      - DPC_SSAS-CLIENT_CLIENT-SECRET=?
      - DPC_CA_CERT=LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURJRENDQWdnQ0NRRFl4YzZmUmVKSXpEQU5CZ2txaGtpRzl3MEJBUXNGQURCU01Rc3dDUVlEVlFRR0V3SlYKVXpFTE1Ba0dBMVVFQ0F3Q1EwRXhFekFSQmdOVkJBY01Da3h2YzBGdVoyVnNaWE14RFRBTEJnTlZCQW9NQkVGRApUVVV4RWpBUUJnTlZCQU1NQ1d4dlkyRnNhRzl6ZERBZUZ3MHlNVEE0TURNeU1ERXpNREphRncweU1qQTRNRE15Ck1ERXpNREphTUZJeEN6QUpCZ05WQkFZVEFsVlRNUXN3Q1FZRFZRUUlEQUpEUVRFVE1CRUdBMVVFQnd3S1RHOXoKUVc1blpXeGxjekVOTUFzR0ExVUVDZ3dFUVVOTlJURVNNQkFHQTFVRUF3d0piRzlqWVd4b2IzTjBNSUlCSWpBTgpCZ2txaGtpRzl3MEJBUUVGQUFPQ0FROEFNSUlCQ2dLQ0FRRUF5eWx4Y0lzZUV0ckVqZ1I1QWNhK3ZPenpDYzRiCk91TUxaazVVcnJnQWI2Qy9yNGFWQzN1bVlOUTNtd2J5eGhwYjUwNUd4dHdDZ0hCR0tpMzB2Q1AzNWtqbjFyZG4Ka3B3V2J2aWJTR0NyV2xQc0hBSHFBSnhtaTFjL1ozVlFSRnh5bm52dXQ4L0ZEditpWW9BdVAzM3QyTzhWMTlaVgpJRzY0bTZVSFYzckh1V1RmMDN3Vk1IQzNNSlUxTjVZM0IvVCsxUjRwNGl4R2laRUhQVFJGMzlEenlDK1ZyYjRjCklCSXZxd3cyUk5MMHFZdGpRVmFMendOVmhrRXFTblhBODhTZ0p3TG1hTWh3dkczQktGQ245c2dXVDBoeFNGOTYKNWVvbVA3enU3QW5xbVFsUXBaUmEwR2cvS01IYytUYXMzN2dwL3MvTVZKSDlrNjNneXRvQ3l6U2ZYd0lEQVFBQgpNQTBHQ1NxR1NJYjNEUUVCQ3dVQUE0SUJBUUFhM1lZRCt4MjlMblllTXNnbGt0amlyQmZpMlJSeGdiQkh6VXQ5Ci9xa3dvVEQ4dGdEQnFRenhJNXhOY0QzblhPOUIwMTVBRms2ems5TUFLL2dwSkJTWk9HUGRhaHhBVXI3SGkvdWEKczQyNU56ZEczN29HaTkyaXZjLzc3M2t4YmxQK0xWczBjekMvWElqVExDaGtzVVN3ZEU3VTRiZGpMZk9Sa2p6VApVTnhkUktReHpCcElWL0FXRnk1VlMrQXZPaC82QngzRDlZdFVaMUZJTWlmdHUvbnptaENBMCszQURSMnlVTGo3CnFMblNpQXMrajh6R09iS1FtWFdMdGlUcjAraCtUeDdlS1Y2S1krN3pCNXJSY1hsZlFkMVNGWUlwR3E3Tk00eDgKTmVXZ0xoc3YrVFYyUjVEdC9oMGhvREMyNDFDRmdGTU9sb3ZHT2pNTUFqeUoxUkJMCi0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K
      - DPC_CERT=LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURXakNDQWtLZ0F3SUJBZ0lKQU85czJDTnBET1dlTUEwR0NTcUdTSWIzRFFFQkN3VUFNRkl4Q3pBSkJnTlYKQkFZVEFsVlRNUXN3Q1FZRFZRUUlEQUpEUVRFVE1CRUdBMVVFQnd3S1RHOXpRVzVuWld4bGN6RU5NQXNHQTFVRQpDZ3dFUVVOTlJURVNNQkFHQTFVRUF3d0piRzlqWVd4b2IzTjBNQjRYRFRJeE1EZ3dNekl3TVRNd00xb1hEVEl5Ck1EZ3dNekl3TVRNd00xb3dWakVMTUFrR0ExVUVCaE1DVlZNeEN6QUpCZ05WQkFnTUFrTkJNUk13RVFZRFZRUUgKREFwTWIzTkJibWRsYkdWek1SRXdEd1lEVlFRS0RBaEJRMDFGSUVGUVNURVNNQkFHQTFVRUF3d0piRzlqWVd4bwpiM04wTUlJQklqQU5CZ2txaGtpRzl3MEJBUUVGQUFPQ0FROEFNSUlCQ2dLQ0FRRUF1MEQydXVKaG5SMlE4V3JrCnR1SFBwS2JzdXR3RTdYWmRDYmRnZEFsYjBNUG1Tc1M3T1Z4SzhDT2JjaFJBUkZLVFpJcVdkeUc4ZVZkYkpnTUkKVklhRC81MXJIWHdIYU9nakcrUHlHclgxSEhraHVWUzkvZ2FvOG9HaWI5SGJKUmxxSTV1YVZvQmZFZHY1OFVWRgowZWdMSk5HMVJZcnEyUmNZcjVoTkY1QzEwRTdKYzZqQWhyL3FldU10bTNUS2ZNRzhFUEZRQUV2TEtjZ1l6L0xjCmhJOW5aV1N4aU9YckJveHlRcVZub0ZJSXdFN0FPbXRzTG4wOXB2amNuaGhPWUszaWFNbFQwWkZ4VXVIS1BhKzMKRkorL0RhaFNvNXFQay9zYTM5ditxNzJRSEt2eEl0R0pRSENXcVB6Smw4azJlc2NHYXFkTDhXbTZJaW5RWDRtagpHVnZtelFJREFRQUJveTh3TFRBckJnTlZIUkVFSkRBaWdnbHNiMk5oYkdodmMzU0NGV3h2WTJGc0xtRndhUzVrCmNHTXVZMjF6TG1kdmRqQU5CZ2txaGtpRzl3MEJBUXNGQUFPQ0FRRUFKY1pGdVBUVGxXRTNaVmZvZWhZV3Y2Ty8KeCtoYTdwODcwdHgwajd4cEtCR0pjcEZCZEJhYVoyS0FvaTNMU3lVKzE4KytzcnFXaGlXUUhxdFpMUlRPOVNDeQpjU2FTU1NCTllvRDF1cFU0ajB0U29Sdmg2QmQyczZiUHpnY2xPK3pkR1A3RnY2d0NhN0owVEhQWEJNZXVSQ0JNClBncFg1VFkzWWYxN0lnSFlBVldpSlRyN1YxRUV2S3M1ZVhwL2NtWTZPS1BJVGxDdjVJN1c5VlQvbFRFR1NBODEKTDQ0NDZBaGczRVhza2xGVnNkZmhjTXhFby9RWFFPeE5VSlkrNDJpN05BSENPVDJ0aGFYWTRkWW1CQW1tajdYVgpMa3M2c09jL083enhPUzF6cFNwNDJ0eHlVNjNUOUdUdnYwY0F6NTNaV01ndWc2WldCWThQdUlkMjhlTGNBQT09Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K
      - DPC_CERT_KEY=LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlFb3dJQkFBS0NBUUVBdTBEMnV1SmhuUjJROFdya3R1SFBwS2JzdXR3RTdYWmRDYmRnZEFsYjBNUG1Tc1M3Ck9WeEs4Q09iY2hSQVJGS1RaSXFXZHlHOGVWZGJKZ01JVklhRC81MXJIWHdIYU9nakcrUHlHclgxSEhraHVWUzkKL2dhbzhvR2liOUhiSlJscUk1dWFWb0JmRWR2NThVVkYwZWdMSk5HMVJZcnEyUmNZcjVoTkY1QzEwRTdKYzZqQQpoci9xZXVNdG0zVEtmTUc4RVBGUUFFdkxLY2dZei9MY2hJOW5aV1N4aU9YckJveHlRcVZub0ZJSXdFN0FPbXRzCkxuMDlwdmpjbmhoT1lLM2lhTWxUMFpGeFV1SEtQYSszRkorL0RhaFNvNXFQay9zYTM5ditxNzJRSEt2eEl0R0oKUUhDV3FQekpsOGsyZXNjR2FxZEw4V202SWluUVg0bWpHVnZtelFJREFRQUJBb0lCQVFDMjhIbmNETzBtelVyYwp3UHpmdXU3Y3dvUUc3b3NWMzR4M3dLTEgycGpMOVllWXhtalBXbDZRQzRtRFEwdWlORFp4aElBSnRYam41ek5TCmlLWHJ4bHRSTUY4RXVEYVpCQ25BeHNxeDA5QzYxNURkK205L3JNd0QyQ2gxTEVYNEVjTkROSEx0VFk4VDZLQmcKV2Jnam9acTVodk9kRkdIcVk0a25qQmpOREFERWwzZHJVdTZDNzJrNmZCSmNYQ0NCb1lZMlFOVkxHcCtDVldrVwozSzJVMHZhckNkbFNFNnFndXJtYzdCMEtFTXpFejdaZUY2djBObFdrMnM5dkV4aEVjdTkyb3B5WkJpdFZXaWllCmo4dkxTMGpjV3NteXl2ZmVpZTh0a3M4bnJOdnR6ODBJeVJ0aVllazhpZzNKekllYnQ2SHQ2Z0N6c3NwS204THcKWGVDRXpVT2hBb0dCQU93Z1NncG44Mm9TdHZRdC9mcWpDcmdYMDFxY2kyNWxEa0UxZ2xqeEdHVisyMXdnRHdKZwpucGd6ZUkwbFUyRElFUU5XZllOdVFBVUVaV0tLK1VxcnB1d1RRVTJRRUpBUTlSOFVrWFlaODB0QVh1RGZDQi83ClBra21EbjA2aUZ5VXRvK0lIUFpvQkQrWWlvZ1dPTFNKVlA1UWxyN09ud3Z2ejdzU0l4a0NyMWdWQW9HQkFNc0QKcEdjVkNnME1TbEg3eHpMVFhwVGFWbndKZjNGODVvdXZxK1l1TUgyL2p3L1FzQTd3UElGWGxPMy8zdy9uUlRqVApyQXB3OFlXUTI1VE8wTnVyZTM5WGp1V0grSHZwQWc1QmhLcEtWLzNLQklaNEEzNWJPM2lQdG1xZEtVV2IyT0xLCm5kaTF3SzJUOUNQSWdtQThnMGNjOEpEN3hTekE4cENQMUVvZys0blpBb0dBSWliOWJvbmdmQndlMkN4NnlyQ2cKVVVZbzdMY3R0NWJvTytoSVpTTGgrM1FndUM5dTNGSXJQaXBicWxhV3U2M1VRQjVYWXhZa0xsV1hjR3hYYUVSeApqVDJ2dVU4NEJnNWQxZFA4d2c4NDBFNk1Lb3czdWFCMlB0QkJVajJRRVl2MDU4ZXhJTGFrdnFvS2gycG5ZejFsCnpLN05UdVhGdlUwL1IzaDFHUjM1VEkwQ2dZQVJkSiszS1V6eThFS1hxQUZwc2xqb2pabHdFdFQ5YWhMY29kOHkKN0hmSTZDYWg0bnl3M0NFbnNlTWhUNlhiVlRSVGZZZkdZZzJ5UVZGUUN6UlVIdnVBYUlQbDRub1FGV25TMWZsVgpOdzAzeWgzM2ZldzIraHN6ODQ5b3ZWaW1IbzlZZUxsM3Y3RHdlODg3SUd0dFlPYWN2N1ZEa2hKVEZjZ0ZmQWh4CjAwSXRpUUtCZ0R5T2ptZnVZaS8wbXY1NXdRamhqYnZQc0ZoVDFxZjFvVDJVZDdLZGhrQTFsQ1lGNkttWmVYbGEKSk9acmEwdGZzeis4a2dWcjkvdndGdjdEU2JNc1R1WGd2RWYzZ294dUpCdWgvd08zb1ZDbXVzZDR6dkg3YkpLVApTb085TnRPamFnY2Y3akNxV2tpcXF2T3BaRk5PRTdydHRCaHppbUJTWGRaMFBXK0NnQUZMCi0tLS0tRU5EIFJTQSBQUklWQVRFIEtFWS0tLS0tCg==