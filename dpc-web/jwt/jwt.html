<html>
<head>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jsrsasign/8.0.20/jsrsasign-all-min.js"></script>
<script>
  function generateJWT() {

    var clientToken = document.getElementById("clientToken").value.trim();
    var env = document.getElementById("environment").value.trim();
    var privateKey = document.getElementById("privateKey").value.trim();
    var keyId = document.getElementById("keyId").value.trim();


    var dt = new Date().getTime();
    var uuid = 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {
      var r = (dt + Math.random() * 16) % 16 | 0;
      dt = Math.floor(dt / 16);
      return (c == 'x' ? r : (r & 0x3 | 0x8)).toString(16);
    });

    var data = {
      "iss": clientToken,
      "sub": clientToken,
      "aud": "https://" + env + "/v1/Token/auth",
      "exp": Math.round(new Date().getTime() / 1000) + 300,
      "iat": Math.round(Date.now()),
      "jti": uuid,
    };

    var secret = privateKey;

    const header = {
      'alg': 'RS384',
      'kid': keyId,
    }

    var sPayload = JSON.stringify(data);
    document.getElementById("unsignedJWT").innerHTML = JSON.stringify(data, null, 2);

    var sJWT = KJUR.jws.JWS.sign("RS384", header, sPayload, secret);

    document.getElementById("JWT").innerHTML = sJWT;

  }
</script>

<style type="text/css" media="screen">
    h1 {
        margin: 30px 0;
        font-size: 4em;
        line-height: 1;
        letter-spacing: -1px;
    }
</style>
</head>
<title>CMS DPC Java Web Token (JWT)</title>
<body>

    <h1>Create a JWT</h1>
    <p>
        Environment:<br>
        <input type="text" id="environment" style="width:100%;">

    </p>

    <p>
        Private Key:<br>
        <textarea id="privateKey" rows="20" cols="100"></textarea>

    </p>

    <p>
        Client Token:<br>
        <textarea id="clientToken" rows="10" cols="100"></textarea>

    </p>

    <p>
        Public Key ID:<br>
        <input type="text" id="keyId" placeholder="xxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx" style="width:100%;">

    </p>

   

    <p> <input type="button" value="Generate JWT" onclick="generateJWT()">
    </p>

    <p>
        Unsigned JWT:<br>
        <textarea id="unsignedJWT" rows="20" cols="100"></textarea>
    </p>
    <p>
    Your JWT:<br>
        <textarea id="JWT" rows="20" cols="100"></textarea>
    </p>
</body>
</html>
