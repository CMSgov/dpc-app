<% title "New Public Key" %>

<div class="ds-l-container ds-u-padding-x--0">

  <section class="ds-u-display--flex ds-u-justify-content--between ds-u-align-items--center">

    <h1 class="ds-u-font-size--title ds-u-font-weight--normal ds-u-margin--0">Add a public key</h1>

  </section>

  <section class="box box--flex">
    <div class="box__content box--flex">
      <p class="ds-text--lead">Copy the whole public key including the <code class="ds-u-fill--warn-lightest ds-u-color--primary-darkest">BEGIN PUBLIC KEY</code> and <code class="ds-u-fill--warn-lightest ds-u-color--primary-darkest">END PUBLIC KEY</code> tags before and after.</p>
      <p><strong>Example:</strong></p>
      <%= image_tag("public_key.svg", class: "img--outline", alt: "") %>

      <h3>Creating a Signature Snippet</h3>
      <p class="ds-text--lead">Create a <code class="ds-u-fill--warn-lightest ds-u-color--primary-darkest">snippet.txt</code> file with the line <code class="ds-u-fill--warn-lightest ds-u-color--primary-darkest">This is the snippet used to verify a key pair in DPC.</code> in the first line of the file.</p>

      <p class="ds-text--lead">In your command line, create your signature key with:</p>
      
      <code class="ds-u-fill--warn-lightest ds-u-color--primary-darkest">openssl dgst -sign private.pem -sha256 -out snippet.txt.sig snippet.txt</code>
      
      <p class="ds-text--lead">To verify the signature with the public key:</p>

      <code class="ds-u-fill--warn-lightest ds-u-color--primary-darkest">openssl dgst -verify public.pem -sha256 -signature snippet.txt.sig snippet.txt</code>

      <p class="ds-text--lead">To create your signature snippet:</p>

      <code class="ds-u-fill--warn-lightest ds-u-color--primary-darkest">openssl base64 -in snippet.txt.sig -out snippet.txt.sigb64</code>
    </div>
    <div class="box__content">
      <p class="ds-text--lead">This key will be added for <strong><%= @organization.name %></strong>.</p>

      <%= form_tag organization_public_keys_path(organization_id: params[:organization_id]), method: :post do %>
        <div class="field ds-u-margin-y--5">
          <%= label_tag :api_environment, "Environment", class: "ds-c-label" %>
          <%= select_tag :api_environment, options_for_select(@organization.registered_api_envs, params[:api_environment]), include_blank: true, class: "ds-c-field drop-down" %>
        </div>

        <div class="field ds-u-margin-y--5">
          <%= label_tag :label, "Label", class: "ds-c-label" %>
          <%= text_field_tag :label, params[:label], class: "ds-c-field" %>
        </div>

        <div class="field ds-u-margin-y--5">
          <%= label_tag :public_key, "Public Key", class: "ds-c-label" %>
          <%= text_area_tag :public_key, params[:label], class: "ds-c-field" %>
        </div>

        <div class="field ds-u-margin-y--5">
          <%= label_tag :snippet_signature, "Signature Snippet", class: "ds-c-label" %>
          <%= text_area_tag :snippet_signature, params[:label], class: "ds-c-field" %>
        </div>

        <%= submit_tag "Add key", class: "ds-c-button ds-c-button--primary", data: { test: "form-submit" } %>
      <% end %>
    </div>
  </section>
</div>

